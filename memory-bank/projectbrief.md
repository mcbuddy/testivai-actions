# Project Brief: TestivAI Visual Regression Approval GitHub Action

## Overview
This project involves creating a GitHub Action that enables developers to approve or reject visual regression changes generated by TestivAI through PR comments. The action will listen for specific comment formats, process them, and update the necessary files to reflect the approval or rejection status.

## Core Requirements

### 1. Event Trigger
- The GitHub Action must trigger on `issue_comment.created` events
- It should specifically filter for comments matching the formats:
  - `/approve-visuals` (global approval)
  - `/approve-visuals filename.png` (specific file approval)
  - `/reject-visuals filename.png` (specific file rejection)

### 2. Workflow Logic
- When a matching comment is detected:
  - Checkout the current repository (PR branch)
  - Parse the image filename(s) from the comment text
  - Update `approvals.json` with appropriate `approved` or `rejected` entries
  - Include PR metadata in the `meta` section:
    - GitHub login of the commenter
    - PR URL
    - Commit SHA
    - Timestamp (ISO format)
  - Save the updated `approvals.json` file in `.testivai/visual-regression/report/`
  - Commit and push changes back to the PR branch

### 3. Fallback Behavior
- If no specific filename is provided (global approval):
  - Approve all unapproved visual diffs
  - Mark deleted images as `approved` if they're no longer needed
  - Update all relevant entries in the approvals file

### 4. Output Actions
- Commit updated baseline images using `testivai approve --from approvals.json`
- Use GitHub Actions secrets to push changes back to the branch
- Set Git committer identity to match the comment author:
  - Name: GitHub username of commenter
  - Email: GitHub-generated no-reply email for the commenter

### 5. Required Files
- `action.yml`: Action metadata definition
- `entrypoint.sh` or `index.js`: Implementation logic
- `README.md`: Documentation including usage instructions and examples

## Success Criteria
- Developers can approve/reject visual changes directly from PR comments
- The approval process is properly tracked and recorded
- Changes are committed back to the PR branch with correct attribution
- The workflow integrates seamlessly with TestivAI's visual regression testing

## Constraints
- Must work within GitHub Actions environment
- Must handle authentication for pushing changes back to repositories
- Should be efficient and minimize unnecessary processing
